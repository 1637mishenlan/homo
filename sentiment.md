文本情感分析 
=====

<!-- TOC -->

- [1.分析算法](#1分析算法)
    - [1.1 基于情感词典的情感极性分析](#11-基于情感词典的情感极性分析)
        - [1.1.1 词典文件](#111-词典文件)
        - [1.1.2 情感分析](#112-情感分析)
    - [1.2 基于kNN的情感极性分析](#12-基于knn的情感极性分析)
        - [1.2.1 训练数据集](#121-训练数据集)
        - [1.2.2 情感分析](#122-情感分析)
    - [1.3 基于Bayes的情感极性分析](#13-基于bayes的情感极性分析)
    - [1.4 基于最大熵的情感极性分析](#14-基于最大熵的情感极性分析)
    - [1.5 基于SVM的情感极性分析](#15-基于svm的情感极性分析)
    - [1.6 算法比较](#16-算法比较)
- [2.数据处理](#2数据处理)
- [3.运行测试](#3运行测试)

<!-- /TOC -->

# 1.分析算法

## 1.1 基于情感词典的情感极性分析

### 1.1.1 词典文件

假设对外卖评论进行情感分析，涉及到的积极和消极的词汇多是用于点餐和用餐，包含词或句式以及对应的值，`...` 意为省略，词典文件在`data/sentiment/text/dict/`下

1.积极词词典文件`positive_dict.txt`：

```
很快  1.75
还好  1.2
很萌  1.75
服务到位    1
到位    1
凑活  0.8
挺好吃  1.75
挺不错  1.75
满意  2
爱吃  2
好   2
大师傅   2
值得推荐   2
...
```

2.消极词词典文件`negative_dict.txt`：

```
无语  2
醉了  2
没法吃  2
不好  2
太差  5
太油  2.5
有些油  1
咸   1
素质太低  4
太低  3
隔夜肉 2
隔夜 2
...
```

3.连词词典文件`conjunction_dict.txt`：

```
并   1.2
且   1.2
而   1.2
虽然  1.2
不过  1.2
至于  1.2
致   1.2
不料  1.2
岂知  1.2
...
```

4.标点符号词典文件`punctuation_dict.txt`：

```
!   2
！   2
?   1.5
？   1.5
～   1.2
~   1.2
...
```

5.副词词典文件`adverb_dict.txt`：

```
超级  2
超  2
都   1.75
还   1.5
实在  1.75
越来越  2
再也  2
完全  2
真是  1.75
足足  1.75
大大的  1.75
巨  2
最最  2
...
```

6.拒绝词词典文件`denial_dict.txt`：

```
没敢 1
不是  1
休   1
無   1
不曾  1
未必  1
没有  1
不要  1
...
```

7.短语句式词典文件`phrase_dict.txt`：

```
肉……老    -2

提高了……质量  2
希望……提高……质量  -1

被……吃过    -2
再也不……   -3
不会再……   -3

光送……菜    -1
只送……菜    -1
只有……菜    -1
...
```

### 1.1.2 情感分析

**1.首先对数据进行分句**

用正则表达式分别对`是……不是……` 和 `要是|如果……就好了` 句式进行识别，并配合标点符号进行进行分句处理

**2.对分句进行情感分析**

句子的情感值记为`score`，初始为`0`，先用`jieba`对句子进行分词

用正则表达式分别对 `如果……就好了`，`是…不是…` 以及根据短语句式词典文件对短语句式进行识别，如果句式表否定，减去对应句式的值，短语句式直接加上句式对应的值，将短语句式中出现的短语从分词结果中剔除，防止产生干扰

**3.对分词进行情感分析**

用之前的词典文件对词判断词性：连词，标点符号，积极还是消极；对于积极和消极的词汇直接加上或减去在词典文件中对应的值，对于连词和标点符号，统一进行连乘计算

**4.得出整体极性判断**

将所有分句的`score`相加，正表示积极，否则为消极

## 1.2 基于kNN的情感极性分析

kNN(K-Nearest Neighbours)，K最近邻分类算法，

### 1.2.1 训练数据集

采用网络上已经标记好情感极性并分好词的宾馆和外卖评价数据，`pos`意为积极，`neg`意为消极，`...`意为省略，

数据文件在`data/sentiment/text/knn/`下

宾馆评价数据 `ch_hotel_corpus.txt`：

```
pos	距离	川沙	公路	较近	,	但是	公交	指示	不	对	,	如果	是	"	蔡陆线	"	的话	,	会	非常	麻烦	.	建议	用	别的	路线	.	房间	较为简单	.
pos	商务	大床	房	，	房间	很大	，	床有	2M	宽	，	整体	感觉	经济	实惠	不错	!
pos	早餐	太	差	，	无论	去	多少	人	，	那边	也	不加	食品	的	。	酒店	应该	重视	一下	这个	问题	了	。	房间	本身	很	好	。
pos	宾馆	在	小	街道	上	，	不大好	找	，	但	还好	北京	热心	同胞	很多	~	宾馆	设施	跟	介绍	的	差不多	，	房间	很小	，	确实	挺	小	，	但	加上	低价位	因素	，	还是	无超	所值	的	；	环境	不错	，	就	在	小	胡同	内	，	安静	整洁	，	暖气	好足	-	_	-	|	|	。	。	。	呵	还有	一大	优势	就	是从	宾馆	出发	，	步行	不到	十分钟	就	可以	到	梅兰芳	故居	等等	，	京味	小	胡同	，	北海	距离	好近	呢	。	总之	，	不错	。	推荐	给	节约	消费	的	自助游	朋友	~	比较	划算	，	附近	特色小吃	很多	~
...
neg	2	月	20	日	通过	携程	订	的	房	,	结果	告之	没有	普通	标房	只有	行政	标间	,	入住	后	发现	什么	行政	标间	,	根本就是	普通	标房	吗	.	估计	酒店	和	携程	在	打马虎眼	,	298	的	价格	实在	不值	.	后来	逛街	看见	四星级	的	漳州	大酒店	,	真	后悔	没住	那儿	只不过	贵	100	元	.	还有	退房	时	居然	以	侄子	流鼻血	弄脏了	被子	为	由	要	加收	洗衣费	.	鄙视	~	~
neg	这是	第一次	订	这家	酒店	，	酒店	位置	还	可以	，	但	肯定	开业	已经	有	一段	年	月	，	装修	有点	旧	，	办	了	入住	手续	，	进入	房间	，	感觉	房间	的	状况	不好	，	所以	决定	亏	半天	房租	，	还是	另外	找	其它	酒店
...
```

外卖评价数据1 `ch_waimai_corpus.txt`：

```
neg	可以	给	0	分	么	,	送	了	1	个	半小时	,	忽悠	人	呢	,	不能	定	了	,	时间	没准
neg	没	以前	好吃	了
neg	味道	一般	,	还好
neg	没有	按	要求	做	，	有	豆芽	和	海带	。
neg	两个	单都	不	对	！	！	！	！	！	配菜	完全	送错	了	！	大家	都	别	在	这	买	了	！	坑	啊	！
neg	我要	加	的	木耳	没加	…	…
...
pos	干净	，	质量	好	，	超出	期待	，	好
pos	干净	，	快	！
pos	速度	很快	！	快递	小哥	很	客气	！	赞	一个	！	！
pos	非常	不错	，	从未	失望	过
pos	味道	不错	，	快递	小哥	也	很	好
```

外卖评价数据2 `ch_waimai2_corpus.txt`：

```
neg	菜品	质量	好	，	味道	好	，	就是	百度	的	问题	，	总是	用	运力	原因	来	解释	，	我	也	不	懂	这	是	什么	原因	，	晚	了	三个	小时	呵呵	厉害	吧	！	反正	订	了	就	退	不了	，	只能	干	等	…	…
neg	分量	还	可以	…	…	就是	有点	没	特色	…	…	下回	不吃	啦
neg	没什么	味道	，	送来	的	晚凉	了
neg	送餐	送错	，	还	狡辩	不	给	补偿	，	送餐	时间	3	个	小时	，	百度	送	餐员	更是	素质	卑劣	，	额外	还要	加收	17	元	的	外	送费	。	百度	客服	也	没用	，	也	没有	解决	！
neg	完全	不	值得	信任	，	出尔	反而
...
pos	料	很	足	，	味道	也	不错	，	就是	包装	怎么	那么	复杂	？	！
pos	这个	不	好吃	,	吃	的	好	难过
pos	菜量	很足	，	一个	人	吃	一个	卷饼	一碗	粥	压力	很大	…	…	包装袋	不错
pos	肉	很多	啊	，	超值	，	下次	尝试	其他	口味
pos	说实话	肉卷	很	好吃	,	就是	送餐	速度	太慢	了	,	不是	一般	的	慢	,	希望	送餐	速度	有待	提高
...
```

### 1.2.2 情感分析

依据对文本的标注`pos`还是`neg`，将文本分为两类，分别计算词向量(得到不同词的个数，构建词向量)，得到的所有词向量组成一个向量组

将待分析的文本也转为词向量，依次计算与训练出的词向量组中每个词向量的距离

$E(x,y)=\sqrt{\sum_{i=0}^{n}(x_i^2 - y_i^2)}​$

对得到的距离排序，依据设定的 `k`值将距离排序前 `k` 个对应词向量情感极性进行统计，积极大于消极则结果为积极，否则为消极

## 1.3 基于Bayes的情感极性分析

## 1.4 基于最大熵的情感极性分析

## 1.5 基于SVM的情感极性分析

## 1.6 算法比较

|   算法   | 准确率  |               优点               |           缺点           |
| :------: | :-----: | :------------------------------: | :----------------------: |
| 情感词典 |  80%+   |      算法易于理解，准确率高      |       人工工作量大       |
|   kNN    | 60%~70% |        算法简单，易于理解        | 准确率低；耗内存；耗时间 |
|  Bayes   | 70%~80% | 简单，高效，运算速度快，扩展性好 |  准确率不高，达不到实用  |
|  最大熵  |  83%+   |             准确率高             |        训练时间久        |
|   SVM    |   85%   |             准确率高             |         训练耗时         |

# 2.数据处理

# 3.运行测试

